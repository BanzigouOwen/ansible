---
- name: Retrieve and output Cisco running configuration for copy-paste
  hosts: 172.19.98.20  # IP of the Jump Host
  gather_facts: no

  vars:
    target_host: 172.16.3.3  # IP of the Target Switch
    target_switch_username: "{{ target_switch_username }}"  # Username for the switch
    target_switch_password: "{{ target_switch_password }}"  # Password for the switch

  tasks:
    - name: Telnet to the target switch, disable pagination, get running config, and exit in one session
      expect:
        command: "telnet {{ target_host }}"
        responses:
          "Username:": "{{ target_switch_username }}"
          "Password:": "{{ target_switch_password }}"
          "SWOCESC0-1#": "terminal length 0\nshow running-config\nexit\n"
        timeout: 120
        echo: yes
      register: running_config_result
      failed_when: false

    - name: Output the running configuration (plain text copy/paste)
      debug:
        msg: "{{ running_config_result.stdout | regex_replace('\\r', '') }}"
